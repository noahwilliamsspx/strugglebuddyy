<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Struggle Buddy Pairing</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(120deg, #b8eac7, #fbf3b0, #c9e5ff, #e3c8ff);
      background-size: 400% 400%;
      animation: gradientShift 12s ease infinite;
      font-family: Arial, sans-serif;
      flex-direction: column;
      padding: 20px;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    button {
      --primary-color: #f2b74b;
      --secondary-color: #fff;
      --hover-color: #d18a1d;
      border: 0;
      border-radius: 20px;
      color: var(--secondary-color);
      padding: 1em 1.8em;
      background: var(--primary-color);
      display: flex;
      transition: 0.2s background;
      align-items: center;
      gap: 0.6em;
      font-weight: bold;
      cursor: pointer;
      font-size: 1rem;
    }
    button:hover { background-color: var(--hover-color); }
    .input-box { display: none; flex-direction: column; align-items: center; gap: 10px; font-size: 1.1rem; color: #000; }
    .input-box input { padding: 10px 15px; border-radius: 10px; border: none; font-size: 1rem; }
    .input-box button { margin-top: 5px; border-radius: 10px; padding: 8px 12px; border: none; background-color: #f2b74b; color: #fff; font-weight: bold; cursor: pointer; }
    .result { margin-top: 20px; font-weight: bold; font-size: 1.2rem; color: #111; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

  <button id="mainButton">find struggle buddy</button>

  <div class="input-box" id="inputBox">
    <label>Enter your phone number:</label>
    <input type="text" id="phoneInput" placeholder="123-456-7890" />
    <button id="submitPhone">Submit</button>
    <div class="result" id="result"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "strugglebuddy-9ac15",
      authDomain: "strugglebuddy-9ac15.firebaseapp.com",
      databaseURL: "https://strugglebuddy-9ac15-default-rtdb.firebaseio.com",
      projectId: "strugglebuddy-9ac15",
      storageBucket: "strugglebuddy-9ac15.appspot.com",
      messagingSenderId: "1234567890",
      appId: "1:1234567890:web:abcdef123456"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const mainButton = document.getElementById('mainButton');
    const inputBox = document.getElementById('inputBox');
    const resultDiv = document.getElementById('result');

    mainButton.addEventListener('click', () => {
      mainButton.style.display = 'none';
      inputBox.style.display = 'flex';
      document.getElementById('phoneInput').focus();
    });

    document.getElementById('submitPhone').addEventListener('click', () => {
      const number = document.getElementById('phoneInput').value.trim();
      if(!number) return;

      const phoneRef = db.ref('phoneNumbers');

      // Check for existing unpaired numbers
      phoneRef.once('value', snapshot => {
        const unpaired = snapshot.val();
        let paired = false;

        if(unpaired) {
          const keys = Object.keys(unpaired);
          const firstKey = keys[0];
          const firstNumber = unpaired[firstKey];

          // Remove the paired number
          phoneRef.child(firstKey).remove();

          // Show matched number
          resultDiv.textContent = `Your struggle buddy is: ${firstNumber}`;
          paired = true;
        }

        if(!paired) {
          // No available number, add yourself to waiting list
          phoneRef.push(number)
            .then(() => {
              resultDiv.textContent = 'Waiting for someone to be paired with you...you will get a text when pired!';
            })
            .catch(err => alert('Error: ' + err));
        }

        document.getElementById('phoneInput').value = '';
      });
    });
  </script>

</body>
</html>
